# @suspensive/react-query - AI Context

## Package Purpose
Integration layer for @tanstack/react-query that provides Suspense-enabled hooks and components. Auto-detects and supports both v4 and v5 of TanStack Query.

## Key Features
- Suspense-enabled query hooks (data is never undefined)
- Auto-detection of TanStack Query version (v4 or v5)
- CLI tool for version management
- Zero-config switching between versions

## Key Hooks

### `useSuspenseQuery()`
Suspense-enabled version of useQuery. Data is always defined.
```typescript
const { data } = useSuspenseQuery({
  queryKey: ['user', id],
  queryFn: () => fetchUser(id)
})
// data is UserType, not UserType | undefined
```

### `useSuspenseQueries()`
Suspense-enabled version of useQueries.
```typescript
const [query1, query2] = useSuspenseQueries({
  queries: [
    { queryKey: ['user', 1], queryFn: fetchUser },
    { queryKey: ['posts'], queryFn: fetchPosts }
  ]
})
// Both query1.data and query2.data are always defined
```

### `useSuspenseInfiniteQuery()`
Suspense-enabled version of useInfiniteQuery.
```typescript
const { data, fetchNextPage } = useSuspenseInfiniteQuery({
  queryKey: ['posts'],
  queryFn: ({ pageParam }) => fetchPosts(pageParam),
  initialPageParam: 0,
  getNextPageParam: (lastPage) => lastPage.nextCursor
})
```

## Components

### `<SuspenseQuery/>`
Component version of useSuspenseQuery.
```typescript
<SuspenseQuery queryKey={['user']} queryFn={fetchUser}>
  {({ data }) => <UserProfile user={data} />}
</SuspenseQuery>
```

### `<SuspenseInfiniteQuery/>`
Component version of useSuspenseInfiniteQuery.

## CLI Tools

### Version Switching
```bash
# Check current version
pnpm suspensive-react-query version

# Switch to v4
pnpm suspensive-react-query switch v4

# Switch to v5
pnpm suspensive-react-query switch v5
```

## Architecture

This package acts as a facade that wraps:
- `@suspensive/react-query-4` - Internal v4 implementation
- `@suspensive/react-query-5` - Internal v5 implementation

The `postinstall` script detects which version of @tanstack/react-query is installed and configures the package accordingly.

## Important Notes
- Depends on @tanstack/react-query (peer dependency)
- Supports v4.42.0+ and v5.82.0+
- Version auto-detection happens at install time
- Data from Suspense hooks is guaranteed to be defined
- Must be used within QueryClientProvider

## File Structure
- `src/index.ts` - Main entry point with version detection
- `src/v4.ts` - Exports from react-query-4
- `src/v5.ts` - Exports from react-query-5
- `src/bin/cli.ts` - CLI tool implementation
- `src/bin/postinstall.ts` - Version detection script

## Common Patterns

### With Error Boundary
```typescript
<ErrorBoundary fallback={<Error />}>
  <Suspense fallback={<Loading />}>
    <Component />
  </Suspense>
</ErrorBoundary>

function Component() {
  const { data } = useSuspenseQuery(...)
  return <div>{data.name}</div> // data is always defined
}
```

### Parallel Queries
```typescript
const [users, posts] = useSuspenseQueries({
  queries: [
    { queryKey: ['users'], queryFn: fetchUsers },
    { queryKey: ['posts'], queryFn: fetchPosts }
  ]
})
```

## Type Safety
All hooks maintain full type inference from TanStack Query while guaranteeing non-undefined data.
