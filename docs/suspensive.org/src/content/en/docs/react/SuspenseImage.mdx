import { Sandpack, Callout } from '@/components'

# SuspenseImage

A component and hook that loads images asynchronously with Suspense support. `SuspenseImage` suspends rendering until the image is loaded, providing a seamless loading experience.

Both `SuspenseImage` component and `useSuspenseImage` hook use an internal cache to avoid reloading the same image multiple times. In SSR environments, they return a mock object immediately to ensure the image tag is included in the server-rendered HTML.

<Callout type='warning'>

Experimental Feature

This is an experimental feature. The API may change in future versions.

</Callout>

## SuspenseImage Component

The `SuspenseImage` component loads an image asynchronously and suspends rendering until the image is loaded. It uses a render prop pattern to provide the loaded image element.

```tsx /SuspenseImage/
import { SuspenseImage, Suspense } from '@suspensive/react'

function ImageExample() {
  return (
    <Suspense fallback={<div>Loading image...</div>}>
      <SuspenseImage src="https://example.com/image.jpg">
        {(img) => <img src={img.src} alt="Example" />}
      </SuspenseImage>
    </Suspense>
  )
}
```

<Sandpack>

```tsx Example.tsx active
import { SuspenseImage, Suspense } from '@suspensive/react'

export function ImageExample() {
  return (
    <Suspense fallback={<div style={{ padding: 20 }}>Loading image...</div>}>
      <SuspenseImage src="https://picsum.photos/400/300">
        {(img) => (
          <img
            src={img.src}
            alt="Example"
            style={{ maxWidth: '100%', height: 'auto' }}
          />
        )}
      </SuspenseImage>
    </Suspense>
  )
}
```

</Sandpack>

### Props

- `src` (string): The source URL of the image to load
- `children` (function): A render prop that receives the loaded `HTMLImageElement` and returns React nodes

## useSuspenseImage Hook

The `useSuspenseImage` hook loads an image asynchronously and suspends the component until the image is loaded. It returns the loaded `HTMLImageElement` directly.

```tsx /useSuspenseImage/
import { useSuspenseImage, Suspense } from '@suspensive/react'

function ImageComponent() {
  const img = useSuspenseImage('https://example.com/image.jpg')

  return <img src={img.src} alt="Example" />
}

function App() {
  return (
    <Suspense fallback={<div>Loading image...</div>}>
      <ImageComponent />
    </Suspense>
  )
}
```

<Sandpack>

```tsx Example.tsx active
import { useSuspenseImage, Suspense } from '@suspensive/react'

function ImageComponent() {
  const img = useSuspenseImage('https://picsum.photos/400/300')

  return (
    <img
      src={img.src}
      alt="Example"
      style={{ maxWidth: '100%', height: 'auto' }}
    />
  )
}

export function App() {
  return (
    <Suspense fallback={<div style={{ padding: 20 }}>Loading image...</div>}>
      <ImageComponent />
    </Suspense>
  )
}
```

</Sandpack>

### Parameters

- `src` (string): The source URL of the image to load

### Returns

- `HTMLImageElement`: The loaded image element. In SSR, returns a mock object with the `src` property.

## Image Caching

Both `SuspenseImage` and `useSuspenseImage` use an internal cache to avoid reloading the same image multiple times. Once an image is loaded, subsequent requests for the same image will use the cached version.

```tsx /caching/
import { useSuspenseImage, Suspense } from '@suspensive/react'

function MultipleImages() {
  const img1 = useSuspenseImage('https://example.com/image.jpg')
  const img2 = useSuspenseImage('https://example.com/image.jpg') // Uses cache

  return (
    <>
      <img src={img1.src} alt="Image 1" />
      <img src={img2.src} alt="Image 2" />
    </>
  )
}
```

## Clearing the Cache

You can clear the image cache using the `clearImageCache` function. This is useful when you need to force reload images, for example, after updating image URLs.

```tsx /clearImageCache/
import { clearImageCache } from '@suspensive/react'

// Clear all cached images
clearImageCache()
```

## Server-Side Rendering (SSR)

In SSR environments, `SuspenseImage` and `useSuspenseImage` return a mock object immediately instead of suspending. This ensures the `<img>` tag is included in the server-rendered HTML for SEO purposes.

The mock object has the following structure:

```tsx
{ src: string, complete: false } as HTMLImageElement
```

This allows the image tag to be present in the initial HTML, while the actual image loading happens on the client side.
