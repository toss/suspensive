# lazy

> **⚠️ Experimental**: This is a experimental feature. Use with caution in production environments.

The `lazy` function is a safe wrapper around React's `lazy` function that provides automatic error recovery when component loading fails.

## Import

```tsx
import { lazy } from '@suspensive/react'
```

## Basic Usage

```tsx
const MyComponent = lazy(() => import('./MyComponent'))
```

## API

### `lazy<T>(load, options?)`

Creates a lazy-loaded component with optional error recovery.

#### Parameters

- `load`: `() => Promise<{ default: T }>` - Import function
- `options`: `{ safe?: boolean }` - Options object
  - `safe`: When `true`, enables automatic error recovery with page reload

#### Returns

- `LazyExoticComponent<T> & { load: () => Promise<void> }` - React lazy component with additional `load` method

## Features

### Load Method

The returned component includes a `load` method for manual loading:

```tsx
const Component = lazy(() => import('./Component'))
Component.load() // Manually trigger the import
```

### Safe Mode

Enable automatic error recovery with the `safe` option:

```tsx
const Component = lazy(() => import('./Component'), { safe: true })
```

When `safe: true`:

- First failure: Reloads the page and retries
- Second failure: Throws the original error

## Examples

### Basic Usage

```tsx
const UserProfile = lazy(() => import('./UserProfile'))

function App() {
  return <UserProfile />
}
```

### With Safe Mode

```tsx
const Dashboard = lazy(() => import('./Dashboard'), { safe: true })

function App() {
  return <Dashboard />
}
```

### Manual Loading

```tsx
const Component = lazy(() => import('./Component'))

// Preload the component
await Component.load()
```

### With Error Boundary

```tsx
import { lazy, ErrorBoundary } from '@suspensive/react'

const Dashboard = lazy(() => import('./Dashboard'), { safe: true })

function App() {
  return (
    <ErrorBoundary fallback={<div>Something went wrong</div>}>
      <Dashboard />
    </ErrorBoundary>
  )
}
```

## Limitations

- **Browser Only**: Requires `window.sessionStorage` and `window.location`
- **Page Reload**: Safe mode involves a full page reload
- **Experimental**: This feature is still experimental and may change

## Migration from React.lazy

```tsx
// Before
const Component = lazy(() => import('./Component'))

// After (identical API)
const Component = lazy(() => import('./Component'))
```

The API is identical to `React.lazy`, so you can easily replace existing lazy components.
