# lazy

> **⚠️ 실험적**: 이것은 실험적인 기능입니다. 프로덕션 환경에서 사용할 때 주의하세요.

`lazy` 함수는 컴포넌트 로딩이 실패할 때 자동 오류 복구를 제공하는 React의 `lazy` 함수의 안전한 래퍼입니다.

## Import

```tsx
import { lazy } from '@suspensive/react'
```

## 기본 사용법

```tsx
const MyComponent = lazy(() => import('./MyComponent'))
```

## API

### `lazy<T>(load, options?)`

선택적 오류 복구 기능이 있는 지연 로드 컴포넌트를 생성합니다.

#### 매개변수

- `load`: `() => Promise<{ default: T }>` - Import 함수
- `options`: `{ safe?: boolean }` - 옵션 객체
  - `safe`: `true`일 때, 페이지 새로고침을 통한 자동 오류 복구를 활성화

#### 반환값

- `LazyExoticComponent<T> & { load: () => Promise<void> }` - 추가 `load` 메서드가 있는 React 지연 컴포넌트

## 기능

### Load 메서드

반환된 컴포넌트에는 수동 로딩을 위한 `load` 메서드가 포함됩니다:

```tsx
const Component = lazy(() => import('./Component'))
Component.load() // 수동으로 import 트리거
```

### Safe 모드

`safe` 옵션으로 자동 오류 복구를 활성화합니다:

```tsx
const Component = lazy(() => import('./Component'), { safe: true })
```

`safe: true`일 때:

- 첫 번째 실패: 페이지를 새로고침하고 재시도
- 두 번째 실패: 원래 오류를 던짐

## 예제

### 기본 사용법

```tsx
const UserProfile = lazy(() => import('./UserProfile'))

function App() {
  return <UserProfile />
}
```

### Safe 모드와 함께

```tsx
const Dashboard = lazy(() => import('./Dashboard'), { safe: true })

function App() {
  return <Dashboard />
}
```

### 수동 로딩

```tsx
const Component = lazy(() => import('./Component'))

// 컴포넌트를 미리 로드
await Component.load()
```

### 오류 경계와 함께

```tsx
import { lazy, ErrorBoundary } from '@suspensive/react'

const Dashboard = lazy(() => import('./Dashboard'), { safe: true })

function App() {
  return (
    <ErrorBoundary fallback={<div>문제가 발생했습니다</div>}>
      <Dashboard />
    </ErrorBoundary>
  )
}
```

## 제한사항

- **브라우저 전용**: `window.sessionStorage`와 `window.location`이 필요합니다
- **페이지 새로고침**: Safe 모드는 전체 페이지 새로고침을 포함합니다
- **실험적**: 이 기능은 아직 실험적이며 변경될 수 있습니다

## React.lazy에서 마이그레이션

```tsx
// 이전
const Component = lazy(() => import('./Component'))

// 이후 (동일한 API)
const Component = lazy(() => import('./Component'))
```

API는 `React.lazy`와 동일하므로 기존 지연 컴포넌트를 쉽게 교체할 수 있습니다.
