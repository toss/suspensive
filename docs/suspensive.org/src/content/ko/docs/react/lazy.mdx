import { Callout } from '@/components'

# lazy

<Callout type='experimental'>

`lazy`는 실험 기능이므로 이 인터페이스는 변경될 수 있습니다.

</Callout>

`lazy` 함수는 React의 `lazy` 함수를 래핑하여 컴포넌트 로딩 성공과 실패에 대한 콜백을 제공합니다. 컴포넌트가 성공적으로 로드되거나 실패할 때 사용자 정의 로직을 실행할 수 있어 더 나은 사용자 경험과 디버깅을 제공합니다.

## 기본 사용법

```tsx
import { lazy } from '@suspensive/react'

const MyComponent = lazy(() => import('./MyComponent'))
```

기본적으로 `lazy`는 React의 `lazy`와 동일하게 작동하지만, 추가적인 `load` 메서드를 제공합니다.

## 작동 방식

1. **성공 시**: 컴포넌트가 정상적으로 로드되면 `onSuccess` 콜백이 호출됩니다
2. **실패 시**: 컴포넌트 로딩이 실패하면 `onError` 콜백이 호출됩니다
3. **사전 로딩**: `load` 메서드를 사용하여 컴포넌트를 렌더링하지 않고 미리 로드할 수 있습니다

## 동작

- **성공**: 컴포넌트가 정상적으로 로드됨, `React.lazy`와 동일
- **실패**: 오류가 던져져서 오류 경계가 처리할 수 있음
- **콜백**: 성공/실패 시점에 사용자 정의 로직 실행 가능

## 예제

### 기본 컴포넌트 로딩

```tsx
import { lazy, Suspense, ErrorBoundary } from '@suspensive/react'

const UserProfile = lazy(() => import('./UserProfile'))

function App() {
  return (
    <ErrorBoundary fallback={<div>문제가 발생했습니다</div>}>
      <Suspense fallback={<div>로딩 중...</div>}>
        <UserProfile />
      </Suspense>
    </ErrorBoundary>
  )
}
```

### 성공/실패 콜백 사용

#### 성공 콜백

```tsx
import { lazy, Suspense, ErrorBoundary } from '@suspensive/react'

const UserProfile = lazy(() => import('./UserProfile'), {
  onSuccess: () =>
    console.log('UserProfile 컴포넌트가 성공적으로 로드되었습니다'),
})

function App() {
  return (
    <ErrorBoundary fallback={<div>문제가 발생했습니다</div>}>
      <Suspense fallback={<div>로딩 중...</div>}>
        <UserProfile />
      </Suspense>
    </ErrorBoundary>
  )
}
```

#### 오류 콜백

```tsx
import { lazy, Suspense, ErrorBoundary } from '@suspensive/react'

const UserProfile = lazy(() => import('./UserProfile'), {
  onError: ({ error }) => {
    console.error('UserProfile 로딩 실패:', error)
    // 추가적인 오류 처리 로직
  },
})

function App() {
  return (
    <ErrorBoundary fallback={<div>문제가 발생했습니다</div>}>
      <Suspense fallback={<div>로딩 중...</div>}>
        <UserProfile />
      </Suspense>
    </ErrorBoundary>
  )
}
```

### 컴포넌트 사전 로딩

```tsx
import { lazy, Suspense } from '@suspensive/react'

const Component = lazy(() => import('./Component'))

function PreloadExample() {
  const handlePreload = () => {
    Component.load() // 컴포넌트 사전 로딩
  }

  return (
    <div>
      <button onClick={handlePreload}>컴포넌트 사전 로딩</button>
      <Suspense fallback={<div>로딩 중...</div>}>
        <Component />
      </Suspense>
    </div>
  )
}
```

### 커스텀 Lazy 팩토리

```tsx
import { lazy } from '@suspensive/react'

// 기본 성공/실패 콜백이 설정된 커스텀 lazy 팩토리
const customLazy = lazy.create({
  onSuccess: () => console.log('컴포넌트가 성공적으로 로드되었습니다'),
  onError: ({ error }) => console.error('컴포넌트 로딩 실패:', error),
})

const HeavyComponent = customLazy(() => import('./HeavyComponent'))
// 이 특정 컴포넌트에 대해 기본 콜백을 재정의
const LightComponent = customLazy(() => import('./LightComponent'), {
  onSuccess: () => console.log('LightComponent 로드 완료'),
  onError: ({ error }) => {
    console.error('LightComponent 로딩 실패:', error)
    // 특별한 오류 처리 로직
  },
})

function App() {
  return (
    <div>
      <HeavyComponent />
      <LightComponent />
    </div>
  )
}
```
