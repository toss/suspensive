import { Callout, Sandpack } from '@/components'

# useForesight

`js.foresight`와 통합되어 마우스 궤적, 키보드 내비게이션, 스크롤 동작을 기반으로 사용자 상호작용을 예측하는 React 훅입니다. 사용자가 실제로 요소와 상호작용하기 전에 미리 프리페칭 및 UI 최적화를 가능하게 합니다.

<Callout type="info">
`useForesight` 훅은 [`js.foresight`](https://foresightjs.com/) 라이브러리와 통합되어 예측적 상호작용 감지를 제공합니다. 이를 통해 사용자가 실제로 클릭하거나 상호작용하기 전에 콜백을 트리거하여 스마트한 프리페칭 전략을 구현할 수 있습니다.
</Callout>

```tsx
import { useForesight } from '@suspensive/react-dom'
import { usePrefetchQuery } from '@suspensive/react-query'

const PostCard = ({ post }: { post: Post }) => {
  const prefetchComments = usePrefetchQuery({
    queryKey: ['posts', post.id, 'comments'],
    queryFn: () => getPostComments(post.id),
  })
  
  const { ref } = useForesight({
    callback: () => {
      // 사용자가 요소와 상호작용할 가능성이 높을 때 호출됩니다
      prefetchComments()
    },
    name: `post-${post.id}`,
    hitSlop: 10,
  })

  return (
    <div ref={ref}>
      <h2>{post.title}</h2>
      <p>{post.description}</p>
      <Link to={`/posts/${post.id}/comments`}>댓글 보기</Link>
    </div>
  )
}
```

## 기본 사용법

이 훅은 `ref` 함수와 등록 정보를 반환하여 상호작용 예측을 추적할 수 있습니다.

<Sandpack>

```tsx Example.tsx active
import { useForesight } from '@suspensive/react-dom'
import { useState } from 'react'

export const Example = () => {
  const [lastPrediction, setLastPrediction] = useState('')
  
  const { ref, isRegistered, registerResult } = useForesight({
    callback: () => {
      setLastPrediction(`상호작용 예측 시간: ${new Date().toLocaleTimeString()}`)
    },
    name: 'basic-example',
  })

  return (
    <div style={{ padding: 20 }}>
      <button
        ref={ref}
        style={{
          padding: '15px 30px',
          backgroundColor: isRegistered ? 'lightblue' : 'lightgray',
          border: 'none',
          borderRadius: 4,
          cursor: 'pointer',
          fontSize: 16,
        }}
        onClick={() => alert('실제로 클릭했습니다!')}
      >
        마우스를 가져다 대거나 가까이 움직여보세요
      </button>
      
      <div style={{ marginTop: 15 }}>
        <p><strong>등록 상태:</strong> {isRegistered ? '등록됨' : '등록되지 않음'}</p>
        <p><strong>터치 디바이스:</strong> {registerResult?.isTouchDevice ? '예' : '아니오'}</p>
        <p><strong>제한된 연결:</strong> {registerResult?.isLimitedConnection ? '예' : '아니오'}</p>
        <p><strong>마지막 예측:</strong> {lastPrediction || '아직 없음'}</p>
      </div>
    </div>
  )
}
```

</Sandpack>

## options.callback

`callback` 함수는 사용자가 요소와 상호작용할 것으로 예측될 때 호출됩니다.

<Sandpack>

```tsx Example.tsx active
import { useForesight } from '@suspensive/react-dom'
import { useState } from 'react'

export const Example = () => {
  const [predictions, setPredictions] = useState([])
  
  const { ref } = useForesight({
    callback: () => {
      setPredictions(prev => [
        ...prev,
        `예측 ${prev.length + 1} - ${new Date().toLocaleTimeString()}`
      ])
    },
    name: 'callback-example',
    reactivateAfter: 1000, // 여러 예측 허용
  })

  return (
    <div style={{ padding: 20 }}>
      <div
        ref={ref}
        style={{
          padding: '30px',
          backgroundColor: 'lightcoral',
          borderRadius: 8,
          cursor: 'pointer',
          textAlign: 'center',
          userSelect: 'none',
        }}
        onClick={() => alert('클릭됨!')}
      >
        상호작용 영역 - 마우스를 가져다 대세요!
      </div>
      
      <div style={{ marginTop: 20, padding: 10, backgroundColor: '#f0f0f0' }}>
        <h3>예측 기록:</h3>
        <ul>
          {predictions.slice(-5).map((prediction, i) => (
            <li key={i}>{prediction}</li>
          ))}
        </ul>
        {predictions.length > 5 && (
          <p style={{ fontSize: 12, color: 'gray' }}>
            최근 5개 예측 표시 (총 {predictions.length}개)
          </p>
        )}
      </div>
    </div>
  )
}
```

</Sandpack>

## options.hitSlop

`hitSlop`은 요소 주변의 상호작용 감지 영역을 확장합니다.

<Sandpack>

```tsx Example.tsx active
import { useForesight } from '@suspensive/react-dom'
import { useState } from 'react'

export const Example = () => {
  const [hitSlop, setHitSlop] = useState(0)
  const [predictions, setPredictions] = useState(0)
  
  const { ref } = useForesight({
    callback: () => setPredictions(prev => prev + 1),
    name: 'hitslop-example',
    hitSlop,
    reactivateAfter: 500,
  })

  return (
    <div style={{ padding: 50 }}>
      <div style={{ marginBottom: 20 }}>
        <label>
          Hit Slop: 
          <input
            type="range"
            min="0"
            max="50"
            value={hitSlop}
            onChange={e => setHitSlop(Number(e.target.value))}
            style={{ marginLeft: 10 }}
          />
          {hitSlop}px
        </label>
      </div>
      
      <div
        ref={ref}
        style={{
          padding: '20px',
          backgroundColor: 'lightgreen',
          border: '2px solid green',
          borderRadius: 4,
          display: 'inline-block',
          cursor: 'pointer',
        }}
      >
        대상 요소
      </div>
      
      <div style={{ marginTop: 20 }}>
        <p>예측 횟수: <strong>{predictions}</strong></p>
        <p style={{ fontSize: 12, color: 'gray' }}>
          요소 주변에서 마우스를 움직여 hitSlop이 감지에 미치는 영향을 확인해보세요.
        </p>
      </div>
    </div>
  )
}
```

</Sandpack>

## options.disabled

`disabled`를 사용하여 foresight 추적을 조건부로 활성화/비활성화할 수 있습니다.

## options.autoInitialize

ForesightManager의 자동 초기화 여부를 제어합니다.

## 반환값

이 훅은 다음 속성을 가진 객체를 반환합니다:

- **`ref`**: 대상 요소에 연결할 ref 함수
- **`registerResult`**: 등록 결과에 대한 정보 (`isTouchDevice`, `isLimitedConnection` 등 포함)
- **`isRegistered`**: 요소가 현재 ForesightManager에 등록되어 있는지를 나타내는 불린값

<Sandpack>

```tsx Example.tsx active
import { useForesight } from '@suspensive/react-dom'
import { useState } from 'react'

export const Example = () => {
  const [callbackCount, setCallbackCount] = useState(0)
  
  const foresightResult = useForesight({
    callback: () => setCallbackCount(prev => prev + 1),
    name: 'return-value-example',
    reactivateAfter: 2000,
  })

  return (
    <div style={{ padding: 20 }}>
      <div
        ref={foresightResult.ref}
        style={{
          padding: '20px 30px',
          backgroundColor: 'lightyellow',
          border: '1px solid orange',
          borderRadius: 4,
          cursor: 'pointer',
          display: 'inline-block',
        }}
      >
        상호작용 요소
      </div>
      
      <div style={{ marginTop: 20, padding: 15, backgroundColor: '#f5f5f5', borderRadius: 4 }}>
        <h3>훅 반환값:</h3>
        <ul>
          <li><strong>isRegistered:</strong> {String(foresightResult.isRegistered)}</li>
          <li><strong>registerResult.isTouchDevice:</strong> {String(foresightResult.registerResult?.isTouchDevice)}</li>
          <li><strong>registerResult.isLimitedConnection:</strong> {String(foresightResult.registerResult?.isLimitedConnection)}</li>
          <li><strong>콜백 호출 횟수:</strong> {callbackCount}회</li>
        </ul>
      </div>
    </div>
  )
}
```

</Sandpack>